<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.player.prompt.mapper.PromptMapper">

    <insert id="insertPrompt" parameterType="UserPromptEntity">
        INSERT INTO user_prompt (
        id, tenant_id, title, content, disabled,
        categoryId, tags, create_date, update_date, created_by, updated_by
        ) VALUES (
        #{id}, #{tenantId}, #{title}, #{content}, #{disabled},
        #{categoryId}, #{tags}, #{createDate}, #{updateDate}, #{createdBy}, #{updatedBy}
        )
    </insert>

    <delete id="deletePrompt">
        DELETE FROM user_prompt
        WHERE id = #{id} AND tenant_id = #{tenantId} AND created_by = #{createdBy}
    </delete>

    <update id="updatePrompt" parameterType="UserPromptEntity">
        UPDATE user_prompt
        SET title = #{title},
        content = #{content},
        disabled = #{disabled},
        categoryId = #{categoryId},
        tags = #{tags},
        update_date = #{updateDate},
        updated_by = #{updatedBy}
        WHERE id = #{id} AND tenant_id = #{tenantId} AND created_by = #{updatedBy}
    </update>

    <select id="getPromptById" resultType="UserPromptEntity">
        SELECT * FROM user_prompt
        WHERE id = #{id} AND tenant_id = #{tenantId} AND created_by = #{createdBy}
    </select>

    <select id="getPromptList" resultType="UserPromptEntity">
        SELECT * FROM user_prompt
        WHERE tenant_id = #{tenantId} AND created_by = #{createdBy}
        <if test="content != null and content != ''">
            AND content LIKE CONCAT('%', #{content}, '%')
        </if>
        <if test="categoryId != null and categoryId != ''">
            AND categoryId = #{categoryId}
        </if>
        <if test="tags != null and tags != ''">
            AND tags LIKE CONCAT('%', #{tags}, '%')
        </if>
        ORDER BY create_date DESC
    </select>

    <select id="getPromptCategoryList" resultType="PromptCategoryEntity">
        select id,category,create_time,update_time from prompt_category order by update_time desc
    </select>

    <select id="getSystemPromptListByCategory" resultType="SystemPromptEntity">
        select * from system_prompt where category = #{category}
        <if test="keyword != null and keyword != ''">
            and prompt like concat('%',keyword,'%')
        </if>
        order by update_time
        limit #{start},#{pageSize}
    </select>

</mapper>